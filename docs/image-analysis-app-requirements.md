# 画像オブジェクト比率・位置分析アプリ 要件定義書

## 1. アプリケーション概要

### 1.1 目的
画像内のオブジェクトの比率と位置関係を視覚的に分析し、数値データとして取得するためのWebアプリケーション。顔の大きさに対する目の位置の比率など、デザインや分析作業において必要な寸法・位置情報を簡単に取得可能にする。

### 1.2 主な用途
- デザイン分析（黄金比、構図分析など）
- 顔認識・顔分析（顔のパーツ配置の比率測定）
- UI/UXデザインの要素配置分析
- 建築・プロダクトデザインの比率確認

## 2. 機能要件

### 2.1 画像読み込み機能
- **対応フォーマット**: JPEG, PNG, GIF, WebP
- **読み込み方法**:
  - ドラッグ&ドロップ
  - ファイル選択ダイアログ
  - URLからの読み込み（オプション）
- **画像サイズ制限**: 最大10MB
- **プレビュー表示**: 読み込み後即座に表示

### 2.2 親要素（メイン領域）選択機能
- **選択方法**: マウスドラッグによる四角形描画
- **視覚的フィードバック**:
  - ドラッグ中のリアルタイム矩形表示
  - 選択完了後の境界線表示（色: 青、線幅: 2px）
- **編集機能**:
  - 四隅のハンドルによるリサイズ
  - ドラッグによる位置移動
  - 選択のクリア/再選択
- **回転機能**:
  - 回転ハンドル（選択枠外側上部）による回転操作
  - 回転中心: 親要素の中心点
  - 角度範囲: -180°〜180°
  - リアルタイム角度表示
  - スナップ機能: 0°、45°、90°、135°、180°に軽くスナップ

### 2.3 比率情報表示
- **表示項目**:
  - 縦横比（例: 16:9, 4:3）
  - 小数表記（例: 1.78）
  - ピクセル単位の実寸（幅 x 高さ）
- **表示位置**: 選択領域の上部または横

### 2.4 子要素選択機能
- **選択方法**: 親要素内でのマウスドラッグ
- **複数選択**: 最大10個まで
- **視覚的フィードバック**:
  - 異なる色での境界線表示（赤、緑、黄など）
  - 選択順序の番号表示
- **制限事項**: 親要素の範囲外には選択不可

### 2.5 座標系とグリッド表示
- **座標系**:
  - 親要素の中心を原点(0,0)とする
  - X軸: 右方向が正（回転後の親要素基準）
  - Y軸: 下方向が正（回転後の親要素基準）
  - 回転した親要素に追従して座標系も回転
- **グリッドオプション**:
  - 16x16グリッド
  - 32x32グリッド
  - カスタムグリッド（8x8〜64x64）
- **グリッド表示**: 半透明のガイドライン（親要素の回転に追従）

### 2.6 位置・寸法データ取得
- **取得データ**:
  - 子要素の中心座標（グリッド単位）
  - 子要素の四隅座標
  - 親要素に対する面積比率（%）
  - 親要素に対する幅・高さ比率（%）
  - 親要素の回転角度
- **親要素外の子要素**:
  - 最短距離（ピクセル単位）
  - 方向（角度または「上」「右上」等の8方向表記）
  - 警告表示（オレンジ色などで視覚的に区別）
- **データ形式**:
  - JSON形式でのエクスポート
  - CSV形式でのエクスポート
  - クリップボードへのコピー

## 3. UI要件

### 3.1 レイアウト
- **メインエリア**: 画像表示・編集領域（全体の70%）
- **サイドパネル**: 
  - 選択領域一覧
  - 測定結果表示
  - 設定オプション
- **ツールバー**: 
  - グリッド切り替え
  - 選択モード切り替え
  - エクスポートボタン

### 3.2 操作性
- **ショートカットキー**:
  - Ctrl+Z: 元に戻す
  - Delete: 選択領域削除
  - Ctrl+A: 全選択
  - Ctrl+C: データコピー
  - R: 回転モード切り替え
  - Shift+ドラッグ: 15°単位で回転
- **ズーム機能**: マウスホイールで拡大/縮小（10%〜500%）
- **パン機能**: スペースキー+ドラッグ

## 4. 技術要件

### 4.1 フロントエンド
- **フレームワーク**: React.js または Vue.js
- **Canvas API**: 画像描画・図形描画
- **状態管理**: Redux または Vuex

### 4.2 ブラウザ対応
- Chrome (最新版)
- Firefox (最新版)
- Safari (最新版)
- Edge (最新版)

### 4.3 レスポンシブ対応
- 最小画面幅: 1024px
- タブレット対応（タッチ操作）

## 5. データ構造

### 5.1 選択領域データ
```json
{
  "parentRegion": {
    "x": 100,
    "y": 100,
    "width": 400,
    "height": 300,
    "rotation": 45,
    "aspectRatio": "4:3",
    "aspectRatioDecimal": 1.333
  },
  "childRegions": [
    {
      "id": 1,
      "name": "左目",
      "isInside": true,
      "centerCoordinates": {
        "grid": {"x": -5, "y": -3},
        "pixel": {"x": -100, "y": -60}
      },
      "bounds": {
        "x": -120,
        "y": -80,
        "width": 40,
        "height": 40
      },
      "ratios": {
        "areaRatio": 0.0133,
        "widthRatio": 0.1,
        "heightRatio": 0.133
      }
    },
    {
      "id": 2,
      "name": "額の上部",
      "isInside": false,
      "outsideInfo": {
        "distance": 50,
        "direction": "上",
        "angle": 90
      },
      "bounds": {
        "x": -50,
        "y": -200,
        "width": 100,
        "height": 30
      }
    }
  ],
  "gridSettings": {
    "type": "16x16",
    "visible": true
  }
}
```

## 6. 将来的な拡張機能

### 6.1 自動検出機能
- 顔認識による自動パーツ検出
- エッジ検出による図形認識

### 6.2 テンプレート機能
- よく使う比率のプリセット保存
- 黄金比、白銀比などの標準テンプレート

### 6.3 比較分析機能
- 複数画像の同時分析
- 時系列での変化追跡

### 6.4 共有機能
- 分析結果のURL共有
- PDFレポート生成

## 7. 性能要件

### 7.1 レスポンス時間
- 画像読み込み: 3秒以内
- 領域選択: リアルタイム（遅延なし）
- データエクスポート: 1秒以内

### 7.2 画像処理
- 最大解像度: 4096x4096px
- メモリ使用量: 500MB以下

## 8. セキュリティ要件

### 8.1 データ処理
- クライアントサイドでの完結処理
- 画像データのサーバー送信なし
- ローカルストレージへの一時保存（ユーザー許可制）

### 8.2 プライバシー
- 分析データの匿名性確保
- 個人情報を含む画像への警告表示